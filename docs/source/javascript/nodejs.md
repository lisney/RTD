NodeJS
=========

ÏßÅÏõêÍ¥ÄÎ¶¨
---------

1. 'nondmon start'Î°ú Ïã§Ìñâ`

![image](https://user-images.githubusercontent.com/30430227/127253400-28e54c2e-1f4a-455d-8ec5-01dd8e5adbbf.png)
- "main":"server.js" Ïã§ÌñâÌï† ÌååÏùºÎ™Ö ÏßÄÏ†ï


2. express Ïã†Î≤ÑÏ†ÑÏùÄ body-parser ÎÇ¥Ïû•ÎêòÏñ¥ ÏûàÏñ¥
```
    // app.use(bodyParser.urlencoded({extended:true})) bodyParser Î™®Îìà Î∂àÎü¨Ïò¨ ÌïÑÏöîÏóÜÏù¥
    app.use(express.urlencoded({extended:true}))
    app.use(express.json())
```

3. mongoose Îß§ÏÑúÎìú Í∏∞Îä• ÌôïÏû• Î¨∏Ï†ú - handlebars ÏóêÎü¨

` Íµ¨Î≤ÑÏ†ÑÏùÑ ÏÇ¨Ïö©ÌïòÎçòÍ∞Ä Original JSONÏùÑ Î∞òÌôòÌïòÎäî '.lean()'ÏòµÏÖòÏùÑ Ï∂îÍ∞ÄÌïúÎã§ `
```
router.get('/list',(req,res)=>{
    Employee.find((err,docs)=>{
        if(!err){
            res.render('employee/list',{
                list: docs
            })
        }
    }).lean() //lean ÏòµÏÖò Ï∂îÍ∞Ä
})
```

### ÏΩîÎî© ÏãúÏûë
![image](https://user-images.githubusercontent.com/30430227/127324134-a99b4f9f-fd67-4099-85e1-e0ec74b545c3.png)  
![image](https://user-images.githubusercontent.com/30430227/127324201-f6ebddc5-6a2a-44e5-97eb-b83f193aa940.png)

<br>
ÏÑúÎ≤Ñ, ÎùºÏö∞ÌÑ∞ Î∂ÑÎ¶¨, DB Î∂ÑÎ¶¨

` server.js `  

```
const express = require('express')

const path = require('path')

// const bodyParser = require('body-parser')

const hbs = require('express-handlebars')

const app = express()

require('./models/db')

app.get('/',(req,res)=>{
    res.send('Hello world')
})

//bodyParser
    // app.use(bodyParser.urlencoded({extended:true}))
    app.use(express.urlencoded({extended:true}))
    app.use(express.json())
    
    //handlebars
    app.set('views', path.join(__dirname,'/views/'))
    
    app.engine('hbs',hbs({
        extname:'hbs',
        defaultLayout:'layout',
        layoutsdir:__dirname+'/views/layouts/'
    }))
    
    app.set('view engine', 'hbs')
    
    
    app.listen(3000,()=>{
        console.log('Server is listening Port 3000')
    })
    
    //Î≥ÑÎèÑ ÎùºÏö∞ÌÑ∞ ÏÇ¨Ïö©ÌïòÍ∏∞
    const employeeRouter =require('./routers/employeeRouter')
    app.use('/employee', employeeRouter) // '/employee' Í≤ΩÎ°ú
```
<br>
ÎùºÏö∞ÌÑ∞

`employeeController.js`
```
const express = require('express')
const mongoose = require('mongoose')
const Employee = mongoose.model('Employee')


const router = express.Router()
// router.use(express.urlencoded({extended:true}))
// router.use(express.json())

router.get('/',(req,res)=>{
    res.render('employee/addOrEdit',{
        viewTitle:"Insert Employee"
    })
})

// ÏßÅÏõê ÏûÖÎ†•
router.post('/',(req,res)=>{
    if(req.body._id==""){
        insertRecord(req, res)
    }else{
        updateRecord(req, res)
    }
})

// ÏßÅÏõê Î¶¨Ïä§Ìä∏ Î≥¥Í∏∞
router.get('/list',(req,res)=>{
    Employee.find((err,docs)=>{
        if(!err){
            res.render('employee/list',{
                list: docs
            })
        }
    }).lean()
})

function insertRecord(req,res)
{
    let employee = new Employee()
    employee.fullName = req.body.fullName
    employee.email = req.body.email
    employee.mobile = req.body.mobile

    employee.save((err, doc)=>{
        if(!err){
            res.redirect('employee/list')
        }else{
            if(err.name=='ValidationError'){
                handleValidationError(err, req.body)
                res.render('employee/addOrEdit',{
                    viewTitle:'Insert Employee',
                    employee:req.body
                })
            }
            console.log('Error occured during record insertion'+ err)
        }
    })
}

router.get('/:id',(req,res)=>{
    Employee.findById(req.params.id,(err,doc)=>{
        if(!err){
            res.render('employee/addOrEdit',{
                viewTitle:'Update Employee',
                employee:doc
            })
        }
    }).lean()
})

router.get('/delete/:id',(req,res)=>{
    Employee.findByIdAndRemove(req.params.id,(err,doc)=>{
        if(!err){
            res.redirect('/employee/list')
        }else{
            console.log("An error occured during the Delete Process"+ err)
        }
    }).lean()
})

function handleValidationError(err,body){
    for(field in err.errors)
    {
        switch(err.errors[field].path){
            case 'fullName':
                body['fullNameError']=err.errors[field].message
                break

            case 'email':
                body['emailError'] = err.errors[field].message
                break

                default:
                    break
        }
    }
}

function updateRecord(req,res)
{
// new:true ÏóÖÎç∞Ïù¥Ìä∏ ÌõÑ Î¨∏ÏÑúÎ•º Î∞òÌôòÌïúÎã§(doc), runValidators: ValidationError ÏóêÎü¨ Ï≤¥ÌÅ¨(Íµ¨Î¨∏ÏóêÎü¨)
    Employee.findOneAndUpdate({_id:req.body._id}, req.body,{new:true, runValidators:true},(err,doc)=>{
        if(!err){
            res.redirect('employee/list')
        }else{
            if(err.name=="ValidationError"){
                handleValidationError(err, req.body)
                res.render("employee/addOrEdit",{
                    viewTitle:"Uddate Employee",
                    employee:req.body
                })
                console.log('Error occured in Updating the records'+err)
            }
    })
}

module.exports = router
```
<br>
DB

`db.js, employee.model.js`
```
const mongoose = require('mongoose')

require('dotenv').config({path:'variables.env'})

// const url = "mongodb+srv://root:1234@education.8nfen.mongodb.net/myFirstDatabase?retryWrites=true&w=majority";

mongoose.connect(process.env.MONGODB_URL,{useNewUrlParser:true, useUnifiedTopology: true},(err) => {
    if(!err){ console.log("MongoDB Connection Succeeded");}
    else{
        console.log("An Error Occured");
    } 
})

require('./employee.model');
```
```
const mongoose = require('mongoose')
const validator = require('email-validator')

const employeeSchema = new mongoose.Schema({
    fullName:{
        type:String,
        required:'This field is required'
    },
    email:{
        type:String
    },
    mobile:{
        type:String
    }
})

// custom validation for email

employeeSchema.path('email').validate((val)=>{
    return validator.validate(val)
},'Invalid Email')


mongoose.model('Employee', employeeSchema)

```
<br>
hbs  layout, addOrEdit, list

```
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>
        *{
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            text-decoration: none;
        }
        html, body{
            height: 100%;
            background: rgb(211, 240, 255);
        }
        section{
            width: 60%;
            margin: 20px auto;
            padding: 50px 20px;
            background: white;
        }
        label{
            display: block;

        }
        form{
            margin: 10px 5px;
        }
        input[type='text']{
            width: 60%;
            border-radius: 5px;
            border: 1px solid gray;
            padding: 5px;
        }
        input[type='submit'], .viewAll{
            display: inline-block;
            margin: 10px 5px;
            background: firebrick;
            border: none;
            width: 100px;
            height: 30px;
            text-align: center;
            font-size: 12px;
            color: white;
            line-height: 30px;
            font-weight: bold;
            border-radius: 5px;
        }

        table{
            margin: 30px 10px;
            width: 100%;
            padding: 10px;
            background: white;
            border-top: 1px solid gray ;
            border-style: none;
            border-collapse: collapse;
        }
        th,td{
            border-bottom: 1px solid gray;
            padding: 10px 0;
        }
        tr:nth-child(even){
            background: rgb(238, 238, 238);
        }
        td{
            text-indent: 2em;
        }
        .createNew{
            display: inline-block;
            width: 130px;
            height: 40px;
            background: chocolate;
            color: white;
            line-height: 40px;
            border-radius: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <section>
    {{{body}}}
    </section>
</body>
</html>
```
```
<h3>{{viewTitle}}</h3>

<form action="/employee" method="post" autocomplete="off">
    <input type="hidden" name="_id" value="{{employee._id}}">
    <div>
        <label for="">Full Name</label>
        <input type="text" name="fullName" value="{{employee.fullName}}" placeholder="Full Name">
        <div class="textDanger">
        {{employee.fullNameError}}
        </div>
    </div>
    <div>
        <label for="">Email</label>
        <input type="text" name="email" value="{{employee.email}}" placeholder="Email">
        <div class="textDanger">
        {{employee.emailError}}
        </div>
    </div>
    <div>
        <label for="">Mobile</label>
        <input type="text" name="mobile" value="{{employee.mobile}}" placeholder="Mobile">
    </div>
    <div>
        <input type="submit" value="üöÄÏø®Ïø®">
        {{!-- <span class="viewAll"><a href="#">View All</a></span> --}}
        <a href="/employee/list" class="viewAll">üõíView All</a>
    </div>
</form>
```
```
    <h2>
    <a href="/employee" class="createNew">‚ûïCreate New</a>
        Employee List</h2>
{{!-- {{list}} --}}
<table>
    <thead>
        <tr>
            <th>Full Name</th>
            <th>Email</th>
            <th>Mobile</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {{#each list}}
        <tr>
            <td>{{this.fullName}}</td>
            <td>{{this.email}}</td>
            <td>{{this.mobile}}</td>
            <td><a href="/employee/{{this._id}}">üöÄ</a>
            <a href="/employee/delete/{{this._id}}" onclick="return confirm('Ï†ïÎßêÎ°ú?')">‚ô®</a>
            
            </td>
        </tr>
        {{/each}}

        
    </tbody>
</table>
```

ÏÑúÎ≤Ñ
-----------

### ÏÑúÎ≤Ñ Í∏∞Ï¥à

`request.url/ response.write, response.end`

```
const http = require('http') // http Î™®ÎìàÏùÑ Î∂àÎü¨Ïò®Îã§

const server = http.createServer((request, response)=>{
    console.log(request.url) // '/xxx' Ï£ºÏÜå
    console.log(request.method) 
    if(request.url ==='/'){ 
        res.writeHead(200, {'Content-Type': 'text/html; charset=utf-8'}) //Î∏åÎùºÏö∞Ï†Ä ÌïúÍ∏Ä Íπ®Ïßà Ïãú
                                 // Ï£ºÏÜåÍ∞Ä '/'Ïù¥Î©¥
        response.write('Hello') // ÏÑúÎ≤ÑÏùò ÏùëÎãµ, expressÏóêÏÑ† response.send('text')ÌïòÎ©¥ ÎêúÎã§
        response.end()  // ÏùëÎãµ ÎÅù
    }else{
        response.write('hi')
        response.end()
    }
})

server.listen(3000) // ÏÑúÎ≤ÑÏóêÏÑú ÏöîÏ≤≠Î∞õÍ∏∞(port: 3000)
```

###  ÏÑúÎ≤ÑÏóêÏÑú html ÌååÏùº Î≥¥ÎÇ¥Í∏∞( fs Î™®Îìà)

```
const http = require('http')
const fs = require('fs') // ÎÖ∏Îìújs ÌååÏùºÏãúÏä§ÌÖú Î™®Îìà

const server = http.createServer((request, response)=>{
    console.log(request.url)
    console.log(request.method)
    fs.readFile('./index.html',null, (err, data)=>{
        response.writeHead(200,{ // 200 ÏÉÅÌÉú ÏΩîÎìú ÏñëÌò∏
            'Content-Type':'text/html'
        })
        response.write(data)
        response.end()
    })
})

server.listen(3000)
```

` nodemon ÏÑ§Ïπò`
> npm i -g nodemon

```
Ïã§ÌñâÎ∞©Î≤ï > nodemon server.js
```
<br>
Ìé∏Ìïú ÏÑúÎ≤Ñ express Î™®Îìà
-----------------------

1. package.json ÏÉùÏÑ± // ÏΩîÎìú Î∞∞Ìè¨Î•º Ìé∏ÌïòÍ≤å  
` npm init `

2. express Î™®Îìà ÏÑ§Ïπò  
` npm install express  
> node_modules Ìè¥ÎçîÍ∞Ä ÏÉùÏÑ±ÎêòÏñ¥ Ïó¨Í∏∞Ïóê ÏÑ§ÏπòÍ∞Ä ÎêúÎã§

3. ÏÑúÎ≤Ñ ÏÉùÏÑ±

```
const express = require('express')

const server = express()

server.get('/',(req,res)=>{
    res.status(200).sendFile(__dirname+'/index.html') // __dirname ÌòÑÏû¨ Í≤ΩÎ°ú
})

server.listen(3000, ()=>{
    console.log('The server is running on Port 3000') //ÏÑúÎ≤Ñ Ïã§Ìñâ Î¨∏Íµ¨
})
```

4. static ÌååÏùº ÏÇ¨Ïö©(express.static ÎØ∏Îì§Ïõ®Ïñ¥) server.use

```
const express = require('express')

const server = express()

server.use(express.static(__dirname)) // express.static ÎØ∏Îì§Ïõ®Ïñ¥ ÏÇ¨Ïö©

server.use((req,res,next)=>{ //ÎØ∏Îì§Ïõ®Ïñ¥ Ïù¥Ïñ¥ÏÑú
    //config
    next()
})

server.get('/',(req,res)=>{
    res.status(200).sendFile(__dirname+'/index.html') // __dirname ÌòÑÏû¨ Í≤ΩÎ°ú
})

server.listen(3000, ()=>{
    console.log('The server is running on Port 3000!')
})

(Ï∂îÍ∞Ä) ÏÑúÎ≤Ñ ip Ï£ºÏÜå
server.listen(3000,'192.168.0.33',()=>{}
```

htmlÎûúÎçîÎßÅ Template Engine 'handlebars' /{{}} Ïª¨Î¶¨Î∏åÎùºÏºì
---------------------------------------------------------

1. handlebars ÏÑ§Ïπò  
` npm i express-handlebars`

2. ÏÑúÎ≤Ñ ÌååÏùº

```
const express = require('express')
const hbs = require('express-handlebars')

const server = express()

server.engine('hbs', hbs({
    extname:'hbs',
    defaultLayout:'layout',
    layoutDir:__dirname+'/views/layouts', // views ÌÖúÌîåÎ¶ø Ìè¥Îçî
    partialsDir:__dirname+'/views/partials'
}))

server.set('view engine', 'hbs') // view engine ÏÑ∏ÌåÖ

server.use(express.static(__dirname+'/statics')) // express.static ÎØ∏Îì§Ïõ®Ïñ¥ ÏÇ¨Ïö©

server.use((req,res,next)=>{
    //config
    next()
})

server.get('/',(req,res)=>{
    res.status(200).render('index.hbs') // ÌÖúÌîåÎ¶ø ÎûúÎçî
})

server.listen(3000, ()=>{
    console.log('The server is running on Port 3000!')
})
```

3. layout.hbs  
views/layouts Ìè¥Îçî

```
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>
    <img src="./4g2.jpg" style="width: 200px;" alt="">
    {{{ body }}} //Ïù¥ Î∂ÄÎ∂ÑÏóê index.hbs ÎÇ¥Ïö©Ïù¥ Îì§Ïñ¥Í∞ÑÎã§
</body>
</html>
```

4. index.hbs

views Ìè¥Îçî

```
<h1>ÏïàÎÖï</h1>
```
![image](https://user-images.githubusercontent.com/30430227/126600391-15ab168d-5b2c-4df0-823a-8af006ff2f8d.png)

5. ÏÑúÎ≤ÑÏóêÏÑú index.hbs Î°ú Í∞ùÏ≤¥ Î≥¥ÎÇ¥Í∏∞

ÏÑúÎ≤Ñ ÎÇ¥Ïö© Î≥ÄÍ≤Ω
```
server.get('/',(req,res)=>{
    res.status(200).render('index.hbs',{  //{name:   } Í∞ùÏ≤¥ Ï†ÑÎã¨
        name:'DannyTWLC'
    }) 
})
```
> index.hbs ÎÇ¥Ïö© Î≥ÄÍ≤Ω

```
<h1>ÏïàÎÖï</h1>
<h2>{{name}} ÏïàÎÖï </h2>
```

### nodemon Î≥ÄÍ≤Ω Í∞êÏãú ÌôïÏû•Ïûê ÏÑ§Ï†ï Î∞©Î≤ï

` nodemon server.js --ext .js,.hbs `

### handlebars Ïã§Ïäµ

![image](https://user-images.githubusercontent.com/30430227/126608100-5d13d6de-1753-408b-acae-fbed45c8d493.png)

1. layout.hbs

```
    <style>
        .active{
            color:white;
            background: #000;
        }
    </style>
</head>
<body>
    <img src="./4g2.jpg" style="width: 200px;" alt="">
    <nav>
        <a class="{{#if home}}active{{/if}}" href="/">Home</a>
        <a class="{{#if features}}active{{/if}}" href="/features">Features</a>
        <a class="{{#if contact}}active{{/if}}" href="/contact">Contact</a>
    </nav>
    {{{ body }}}
```

2. server.js

```
server.get('/',(req,res)=>{
    res.status(200).render('index.hbs',{  //{name:   } Í∞ùÏ≤¥ Ï†ÑÎã¨
        home: true
    }) 
})
server.get('/features',(req,res)=>{
    res.status(200).render('index.hbs',{  //{name:   } Í∞ùÏ≤¥ Ï†ÑÎã¨
        features: true
    }) 
})
server.get('/contact',(req,res)=>{
    res.status(200).render('index.hbs',{  //{name:   } Í∞ùÏ≤¥ Ï†ÑÎã¨
        contact: true
    }) 
})
```

3. partials(layout Î∂ÑÎ¶¨)

![image](https://user-images.githubusercontent.com/30430227/126608655-cf6d2ae4-a7f9-407e-949a-4d38782d3e69.png)

```
<body>
    <img src="./4g2.jpg" style="width: 200px;" alt="">
    {{>nav}}

    {{{ body }}}
    
</body>
```

4. #each Î∞òÎ≥µ

![image](https://user-images.githubusercontent.com/30430227/126609548-a83b2faf-8498-46c1-822a-550068a1fe9d.png)

` server.js`

```
server.get('/contact',(req,res)=>{
    res.status(200).render('index.hbs',{  //{name:   } Í∞ùÏ≤¥ Ï†ÑÎã¨
        contact: true,
        list:[
            'Danny','Jenny','boy'
        ]
    }) 
})
```

` index.hbs`

```
<h1>Î∞òÍ∞ë</h1>
<ul>
    {{#each list}}
    <li>{{this}}</li>
    {{/each}}
</ul>
```

### REST API 1) GET method
![image](https://user-images.githubusercontent.com/30430227/126629970-a22d1be7-7c01-4152-8615-f95d4bb06843.png)

 /api/user Ï£ºÏÜåÎ•º ÏûÖÎ†•ÌïòÎ©¥(ÏöîÏ≤≠ÌïòÎ©¥) jsonÎç∞Ïù¥ÌÑ∞Î°ú ÏùëÎãµÌïúÎã§

`Chrome JSON Viewer Ïï†ÎìúÏò® ÏÑ§Ïπò`  
![image](https://user-images.githubusercontent.com/30430227/134854171-c1ab9dcf-ae85-4877-88ea-aab598e67381.png)  

![image](https://user-images.githubusercontent.com/30430227/134854089-0624ae63-2b17-44d2-8e09-7b5391ec0c6f.png)  


```
const express = require('express')

const server = express()

const users =[
    {
    id:'Dan',
    name:'Danny',
    email:'d@dan.com'
    },
    {
    id:'lisney',
    name:'Lee',
    email:'lisney@namver.com'
    }

]

server.get('/api/user',(req, res)=>{
    res.json(users)
})


server.listen(3000,()=>{
    console.log('The server is running')
})
```

### REST POST  body-parser ÏöîÏ≤≠ Îç∞Ïù¥ÌÑ∞ ÌååÏã± ÎØ∏Îì§Ïõ®Ïñ¥

```
const express = require('express')

const bodyParser = require('body-parser') //body-parser

const server = express()

server.use(bodyParser.json()) // JSON ÌååÏã±

const users =[
    {
    id:'Dan',
    name:'Danny',
    email:'d@dan.com'
    },
    {
    id:'lisney',
    name:'Lee',
    email:'lisney@namver.com'
    }

]

server.get('/api/user',(req, res)=>{
    res.json(users)
})

server.post('/api/user',(req, res)=>{
    console.log(req.body) // ÏöîÏ≤≠ Îç∞Ïù¥ÌÑ∞ ÌëúÏãú
    users.push(req.body) // ÏöîÏ≤≠ Îç∞Ïù¥ÌÑ∞ usersÏóê Ï∂îÍ∞Ä
    res.json(users)
})

server.listen(3000,()=>{
    console.log('The server is running')
})
```

![image](https://user-images.githubusercontent.com/30430227/126738802-6d986bc2-7ea4-4fea-93bd-8c8ca5649804.png)

Ìó§ÎçîÏóê Î≥¥ÎÇ¥Îäî Îç∞Ïù¥ÌÑ∞ ÌÉÄÏûÖ JSON

![image](https://user-images.githubusercontent.com/30430227/126738842-11d72ce2-d94b-4e1e-8610-65d6c5c15c51.png)

Î∞îÎîîÏóê JSON Î¨∏ ÏûëÏÑ± ("ÏåçÎî∞Ïò¥Ìëú)


### REST IDÎ•º ÌÜµÌï¥ Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞ params(params.id)

```
server.get("/api/user/:id",(req, res)=>{
    const user = users.find(u=>{
        return u.id === req.params.id // ÏöîÏ≤≠ : ÌååÎùºÎØ∏ÌÑ∞ id ÏôÄ Í∞ôÏùÄÍ≤å ÏûàÎäîÏßÄ Ï∞æÍ∏∞, ÏûàÏúºÎ©¥ true Î¶¨ÌÑ¥
    })
    if(user){
        res.json(user)
    }else{
        res.status(404).json({errorMessage:"User was not found"})
    }
})
```

![image](https://user-images.githubusercontent.com/30430227/126742307-03f57ab0-0fde-49ba-99f8-e28047460665.png)

ÏùëÎãµ!

### REST  put, delete Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏, ÏÇ≠Ï†ú

```
server.put('/api/user/:id',(req, res)=>{
    let foundIndex = users.findIndex(u=>u.id===req.params.id)
    if(foundIndex === -1){
        res.status(404).json({errorMessage:'User was not found'})
    }else{
        users[foundIndex] = {...users[foundIndex], ...req.body} // ... Rest Operator ÎòëÍ∞ôÏùÄ ÌîÑÎ°úÌçºÌã∞Í∞Ä ÏûàÎã§Î©¥ Îí§Ïóê Ïì¥Í±∏Î°ú ÎçÆÏñ¥Ïì∞Í∏∞
        res.json(users[foundIndex])
    }
})
```
`... ÌôïÏÇ∞Ïó∞ÏÇ∞Ïûê(spread operator)`  
```
# Î∞∞Ïó¥ Î∂ÑÌï¥
const [apple, ...notApple] = ['üçé', 'üôå', '‚ô®', 'üöÄ']
console.log(notApple)  //  ['üôå', '‚ô®', 'üöÄ']

# Î∞∞Ïó¥Ïùò Ï§ëÎ≥µÍ∞í Ï†úÍ±∞
const fruit = ['üçé', 'üôå', '‚ô®', 'üôå', 'üöÄ', 'üôå', 'üöÄ']
const uFruit = [...new Set(fruit)]
console.log(uFruit) // ['üçé', 'üôå', '‚ô®', 'üöÄ']

# Î∞∞Ïó¥Ïùò Ìï©ÏßëÌï© - Î≥ëÌï© ÌõÑ Ï§ëÎ≥µÏ†úÍ±∞(set)
fruitA = ['üçé', 'üôå', '‚ô®']
fruitB = ['üôå', '‚ô®', 'üöÄ']

union = [...new Set([...fruitA + ...fruitB])]
console.log(union) // ['üçé', 'üôå', '‚ô®', 'üöÄ']

# Îã§Î•∏ 'Î∞∞Ïó¥'Ïùò ÏöîÏÜåÎ•º ÏïûÏóê Ï∂îÍ∞Ä(pushÎäî Îí§Ïóê Ï∂îÍ∞Ä)
fruit.unshift(['üôå', '‚ô®']
console.log(fruit) // ['üôå', '‚ô®','üçé', 'üôå', '‚ô®', 'üôå', 'üöÄ', 'üôå', 'üöÄ']

## sliceÎ•º ÏÇ¨Ïö©ÌïòÏó¨ Î∞∞Ïó¥ÏùÑ Î≥µÏÇ¨ÌïòÎäî Î∞©Î≤ï
fruitC = fruit.slice()

# Î∞∞Ïó¥ÏóêÏÑú ÏµúÎåÄ/ÏµúÏÜåÍ∞í Ï∞æÍ∏∞
const price = [23,54,33,77]

minPrice = Math.min(...price)
minPrice = Math.max(...price)

## Ïà´ÏûêÎ∞∞Ïó¥ Ï†ïÎ†¨
price.sort((a,b)=>a-b) //Ïò§Î¶ÑÏ∞®Ïàú
price.sort((a,b)=>b-a) //ÎÇ¥Î¶ºÏ∞®Ïàú

## Î¨∏ÏûêÎ∞∞Ïó¥ Ï†ïÎ†¨
fruit.sort((a,b)=>a>b?1:a<b?-1:0) //Ïò§Î¶ÑÏ∞®Ïàú
fruit.sort((a,b)=>a>b?-1:a<b?1:0) //ÎÇ¥Î¶ºÏ∞®Ïàú

```


> server.put > ... Rest Operator ÏÇ¨Ïö©

```
server.delete('/api/user/:id', (req, res)=>{
    let foundIndex = users.findIndex(u=> u.id === req.params.id)
    if(foundIndex === -1){
        res.status(404).json({errorMessage:"User was not found"})
    }else{
        let foundUser = users.splice(foundIndex, 1)
        res.json(foundUser[0])
    }
})
```
> server.delete > splice(Ï†ëÌï©, Í≤∞Ìòº)
```
A = B.splice(i,N)
Î∞∞Ïó¥ BÏóêÏÑú Ïù∏Îç±Ïä§ iÎ∂ÄÌÑ∞ NÍ∞úÎßåÌÅº ÏûòÎùºÎÇ∏ ÌõÑ Î∂ôÏó¨ÏÑú Î∞∞Ïó¥ BÏóê Ï†ÄÏû•ÌïòÍ≥†, ÏûòÎùºÎÇ∏ ÏöîÏÜåÎ•º AÏóê Ï†ÄÏû•ÌïúÎã§

```

### ÌååÏùºÏóÖÎ°úÎìú multer ÎØ∏Îì§Ïõ®Ïñ¥

` npm i multer`

```
const multer = require('multer')

const upload = multer({
    storage: multer.diskStorage({
        destination:(req, file, cb)=>{
            cb(null,'uploads/') // cb ÏΩúÎ∞±Ìï®ÏàòÎ•º ÌÜµÌï¥ Ï†ÑÏÜ°Îêú ÌååÏùº Ï†ÄÏû• ÎîîÎ†âÌÜ†Î¶¨ ÏÑ§Ï†ï
        },
        filename: (req, file, cb)=>{
            cb(null, file.originalname) // cb ÏΩúÎ∞±Ìï®ÏàòÎ•º ÌÜµÌï¥ Ï†ÑÏÜ°Îêú ÌååÏùº Ïù¥Î¶Ñ ÏÑ§Ï†ï
        }
    })
})
```
```
server.post('/upload',upload.single('img'), (req, res)=>{
    res.send('ÏóÖÎ°úÎìú ÏÑ±Í≥µ!'+req.file)
})
```

### ÏÑúÎ≤Ñ ÏΩîÎî© Ïó∞Ïäµ

![image](https://user-images.githubusercontent.com/30430227/126763279-d7efa93a-89df-49da-994f-c6e36c6c8f00.png)

> upload.hbs ÌååÏùº ÏúÑÏπò '/views/'

```
<form action="upload" method='post' enctype="multipart/form-data"> // action Ìï¥ÎãπÍ≤ΩÎ°ú '/upload'Î°ú Ïù¥Îèô
    <input type="file" name="img">
    <input type="submit">
</form>
```

>layout.hbs ÌååÏùº ÏúÑÏπò '/views/layouts/'

```
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>
        .active{
            color:white;
            background: #000;
        }
    </style>
</head>
<body>
    <img src="./4g2.jpg" style="width: 200px;" alt="">
    {{>nav}}

    {{{ body }}}
    
</body>
</html>
```

> nav.hbs '/views/partials/'

```
    <nav>
        <a class="{{#if home}}active{{/if}}" href="/">Home</a>
        <a class="{{#if features}}active{{/if}}" href="/features">Features</a>
        <a class="{{#if contact}}active{{/if}}" href="/contact">Contact</a>
    </nav>
```

```
const express = require('express')
const hbs = require('express-handlebars')
const bodyParser = require('body-parser')
//ÌååÏùºÏóÖÎ°úÎìú
const multer = require('multer')

const upload = multer({
    storage: multer.diskStorage({
        destination:(req, file, cb)=>{
            cb(null,'uploads/') // cb ÏΩúÎ∞±Ìï®ÏàòÎ•º ÌÜµÌï¥ Ï†ÑÏÜ°Îêú ÌååÏùº Ï†ÄÏû• ÎîîÎ†âÌÜ†Î¶¨ ÏÑ§Ï†ï
        },
        filename: (req, file, cb)=>{
            cb(null, file.originalname) // cb ÏΩúÎ∞±Ìï®ÏàòÎ•º ÌÜµÌï¥ Ï†ÑÏÜ°Îêú ÌååÏùº Ïù¥Î¶Ñ ÏÑ§Ï†ï
        }
    })
})

//ÏÑúÎ≤Ñ ÏÉùÏÑ±
const server = express()

//hbs ÏóîÏßÑ
server.engine(
    'hbs',
    hbs({
        extname:'hbs',
        defaultLayout:'layout',
        layoutsDir:__dirname+'/views/layouts',
        partialsDir:__dirname+'/views/partials'
    })
)

server.set('view engine', 'hbs')

//ÎØ∏Îì§Ïõ®Ïñ¥
server.use(express.static(__dirname+'/statics')) // statics Í∞Ä Î£®Ìä∏Í≤ΩÎ°úÎ°ú ÏßÄÏ†ïÎêúÎã§

server.use(bodyParser.json())

server.use('/users', express.static(__dirname+'/statics'))// statics Í∞ÄÏÉÅÍ≤ΩÎ°ú ÏßÄÏ†ïÌïòÍ∏∞

server.get('/',(req,res)=>{
    res.status(200).sendFile(__dirname+'/index.html') // __dirname ÌòÑÏû¨ Í≤ΩÎ°ú
})

server.get('/login', (req, res)=>{
    res.send('<h1>login please Goo!</h1>')
})

// ÌååÏùºÏóÖÎ°úÎìú
server.get('/upload', (req, res)=>{
    res.render('upload.hbs',{contact:true}) // '/views' Ìè¥Îçî, contact Î≥ÄÏàò Ï†ÑÎã¨
})
server.post('/upload',upload.single('img'), (req, res)=>{  //.single() Ïù¥ÎØ∏ÏßÄÎ•º Î∞õÏïÑÏÑú req.file Ïóê Ï†ÄÏû•
    res.send('ÏóÖÎ°úÎìú ÏÑ±Í≥µ!'+req.file)  
})

////////////////////
const users =[
    {
    id:'Dan',
    name:'Danny',
    email:'d@dan.com'
    },
    {
    id:'lisney',
    name:'Lee',
    email:'lisney@namver.com'
    }

]
////////GET///////////
server.get('/api/user',(req, res)=>{
    res.json(users)
})

////////POST/////////
server.post('/api/user',(req, res)=>{
    console.log(req.body) // ÏöîÏ≤≠ Îç∞Ïù¥ÌÑ∞ ÌëúÏãú
    users.push(req.body) // ÏöîÏ≤≠ Îç∞Ïù¥ÌÑ∞ usersÏóê Ï∂îÍ∞Ä
    res.json(users)
})

////////PUT/////////////
server.put('/api/user/:id',(req, res)=>{
    let foundIndex = users.findIndex(u=>u.id===req.params.id)
    if(foundIndex === -1){
        res.status(404).json({errorMessage:'User was not found'})
    }else{
        users[foundIndex] = {...users[foundIndex], ...req.body} // ... Rest Operator ÎòëÍ∞ôÏùÄ ÌîÑÎ°úÌçºÌã∞Í∞Ä ÏûàÎã§Î©¥ Îí§Ïóê Ïì¥Í±∏Î°ú ÎçÆÏñ¥Ïì∞Í∏∞
        res.json(users[foundIndex])
    }
})

/////////DELETE/////////////
server.delete('/api/user/:id', (req, res)=>{
    let foundIndex = users.findIndex(u=> u.id === req.params.id)
    if(foundIndex === -1){
        res.status(404).json({errorMessage:"User was not found"})
    }else{
        let foundUser = users.splice(foundIndex, 1) //splice Ï†ëÌï©, Í≤∞Ìòº
        res.json(foundUser[0])
    }
})


server.listen(3000, ['192.168.0.33'], ()=>{
    console.log('The server is running...')
})
```

### Î™ΩÍ≥†db

![image](https://user-images.githubusercontent.com/30430227/126935220-f2819c3a-83f2-48ed-8400-86a9c010a3d6.png)
![image](https://user-images.githubusercontent.com/30430227/126935275-8985f2ba-2d1e-413b-9e5f-4492d886b56a.png)

Î™®Îì†ip Ï£ºÏÜåÎ•º ÌóàÏö©ÌïòÍ∏∞ ÏúÑÌï¥ ÎëêÎ≤à Ï©® Add Different Ip Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ ÌõÑ '0.0.0.0'ÏùÑ ÏûÖÎ†•, ÏÇ¨Ïö©Ïûê root/1234 ÏûÖÎ†•

![image](https://user-images.githubusercontent.com/30430227/126935628-105cc6f5-76c6-40a6-8414-20dfe75d5612.png)

Îëê Î≤àÏß∏ 'Connect your Application' ÌÅ¥Î¶≠
<br>
1. pagkage.json ÏÉùÏÑ±

npm init --y ÌïúÎ∞©Ïóê ÏÉùÏÑ±
<br>
2. Î™®Îìà ÏÑ§Ïπò

npm i express mongoose dotenv //dotenv Î≥¥ÏïàÏùÑ ÏúÑÌï¥ ÌôòÍ≤ΩÎ≥ÄÏàòÎ•º Í¥ÄÎ¶¨ÌïòÎäî Î™®Îìà  
variables.env ÌååÏùº ÏÉùÏÑ±

```
MONGODB_URL=mongodb+srv://root:1234@education.8nfen.mongodb.net/myFirstDatabase?retryWrites=true&w=majority
```

` server.js`

```
const express = require('express')
const mongoose = require('mongoose')
require('dotenv').config({path:'variables.env'})

// console.log(process.env.MONGODB_URL) // dotenv ÎÇ¥ Î≥ÄÏàò 'process.env.Î≥ÄÏàòÎ™Ö'

//Î™ΩÍ≥†dbÏ†ëÏÜç URL
// const MONGODB_URL ='mongodb+srv://root:1234@education.8nfen.mongodb.net/myFirstDatabase?retryWrites=true&w=majority'

mongoose.connect(process.env.MONGODB_URL, {useUnifiedTopology:true, useNewUrlParser: true},(err=>{
    if(err){
        console.log(err)
    }else{
        console.log('Connected to database succefully')
    }
}))
```
<br>
3. Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Î™®Îç∏ ÏÉùÏÑ±

models Ìè¥Îçî ÏÉùÏÑ± > User.js Î™®Îç∏ ÌååÏùº(ÎåÄÎ¨∏ÏûêÎ°ú ÏãúÏûë)

```
const mongoose = require('mongoose')
const {Schema} = mongoose   // const Schema = mongoose.Schema ÏôÄ Í∞ôÎã§

const userSchema = new Schema({
    email:{
        type:String,
        required:true //emailÏù¥ ÏûàÏñ¥Ïïº Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
    },
    name:String,
    age:{
        type:Number,
        min:18,
        max:50
    },
    //Í∞ÄÏûÖ ÏùºÏãú Ï†ÄÏû•
    // enrolled:{
    //     type:Date,
    //     default:Date.now
    // }
},
//Í∞ÄÏûÖÏùº ÏóÖÎç∞Ïù¥Ìä∏ ÏùºÏãú ÏûêÎèôÏ†ÄÏû• enrolled ÌïÑÏöîÏóÜÏùå
{
    timestamps: true
})

module.exports = mongoose.model('User', userSchema)
```

server.js ÏàòÏ†ï

```
const express = require('express')
const mongoose = require('mongoose')
require('dotenv').config({path:'variables.env'})

const User = require('./models/User')

const server = express()

server.get('/',(req, res)=>{
    const newUser = new User()
    newUser.email = "danny@1.com"
    newUser.name = 'Danny'
    newUser.age = 25
    newUser.save().then((user)=>{
        console.log(user)
        res.json({
            message:'User Created Successfully'
        })
    }).catch((err)=>{
        res.json({
            message:"User was not successfully created"
        })
    })
})

server.listen(3000,err=>{
    if(err){
        return console.log(err)
    }else{
        mongoose.connect(process.env.MONGODB_URL, {useUnifiedTopology:true, useNewUrlParser: true},(err=>{
            if(err){
                console.log(err)
            }else{
                console.log('Connected to database succefully')
            }
        }))

    }
})
// console.log(process.env.MONGODB_URL)

//Î™ΩÍ≥†dbÏ†ëÏÜç URL
// const MONGODB_URL ='mongodb+srv://root:1234@education.8nfen.mongodb.net/myFirstDatabase?retryWrites=true&w=majority'
```

<br>
### Î™ΩÍµ¨Ïä§
<br>
 Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïó∞Í≤∞
 
```
var mongoose = require('mongoose');
mongoose.connect('mongodb://localhost/goormdb', { useNewUrlParser });
// ÏúÑÏóêÏÑúÏ≤òÎüº Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Í∞Ä Ïó∞Í≤∞ÎêòÎ©¥, connection Ïù∏Ïä§ÌÑ¥Ïä§Í∞Ä ÏÉùÏÑ±ÎêòÎ©∞ Ïó∞Í≤∞ÎêòÎäî ÏàúÍ∞ÑÏóêÎäî open Ïù¥Î≤§Ìä∏Í∞Ä Î∞úÏÉùÌï©ÎãàÎã§. Ïù¥Îïå Ïù∏Ïä§ÌÑ¥Ïä§Îäî mongoose.connectionÏûÖÎãàÎã§. goormdbÎùºÎäî Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Í∞Ä ÏóÜÎã§Î©¥ mongoDBÎäî Ïù¥Î•º ÏûêÎèôÏúºÎ°ú ÏÉùÏÑ±Ìï©ÎãàÎã§.
```

<br>
 Ïó¨Îü¨Í∞úÏùò Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Î•º Ïó∞Í≤∞Ìï† Îïå

```
var mongoose = require('mongoose');
var connection1 = mongoose.createConnection('mongodb://localhost/mydb1');
var connection2 = mongoose.createConnection('mongodb://localhost/mydb2');
```

<br>

Ïä§ÌÇ§Îßà ÏÉùÏÑ±

```
var Schema = mongoose.Schema, ObjectId = Schema.ObjectId;
var ArticleSchema = new Schema({
    author: ObjectId,
    title: String,
    body: String,
    date: Date
});
```

<br>

Ïä§ÌÇ§ÎßàÎ•º Ïù¥Ïö© Î™®Îç∏ ÏÉùÏÑ±

```
var ArticleModel = mongoose.model('Article', ArticleScheme);
```
<br>

## Ï£ºÏÜåÎ°ù
----------------
![image](https://user-images.githubusercontent.com/30430227/127465755-fb9bcd20-091d-47c2-8d79-8b982629eb35.png)

` server.js`

```
const express = require('express')
const path = require('path')
const hbs = require('express-handlebars')
const { Server } = require('http')
const mongoose = require('mongoose')

const methodOverride = require('method-override')// HTMLÏóê ÏóÜÎäî put, delete Î•º Î∞õÎäîÎã§


const app = express()

// DB
require('./models/db')

// Set
app.engine('hbs',hbs({
    extname:'hbs',
    defaultLayout:'layout',
    layoutsDir:__dirname+'/views/layouts/',
    partialsDir:__dirname+'/views/partials/'
}))
app.set('views', path.join(__dirname+'/views/'))

app.set('view engine','hbs')

// Middleware
app.use(express.static(__dirname+'/statics'))
app.use(express.urlencoded({extended: true})) //bodyParser
app.use(express.json())
app.use(methodOverride('_method')) // New

app.listen(3000,['192.168.0.33'],()=>{
    console.log('Server is running...')
})

// Router
const router = require('./controller/router')
app.use('/user', router)


```
<br>

` db.js`

```
const mongoose = require('mongoose')

require('dotenv').config({path:'variables.env'})

mongoose.connect(process.env.MONGODB_URL, {useNewUrlParser:true, useUnifiedTopology:true},(err)=>{
    if(!err){console.log('MongoDB Connection succeeded')}
    else{
        console.log("An Error Occured")
    }
})

require('./user.model')

```
<br>

` user.model.js`
```
const express = require('express')
const path = require('path')
const hbs = require('express-handlebars')
const { Server } = require('http')
const mongoose = require('mongoose')

const methodOverride = require('method-override')// HTMLÏóê ÏóÜÎäî put, delete Î•º Î∞õÎäîÎã§


const app = express()

// DB
require('./models/db')

// Set
app.engine('hbs',hbs({
    extname:'hbs',
    defaultLayout:'layout',
    layoutsDir:__dirname+'/views/layouts/',
    partialsDir:__dirname+'/views/partials/'
}))
app.set('views', path.join(__dirname+'/views/'))

app.set('view engine','hbs')

// Middleware
app.use(express.static(__dirname+'/statics'))
app.use(express.urlencoded({extended: true})) //bodyParser
app.use(express.json())
app.use(methodOverride('_method')) // New

app.listen(3000,['192.168.0.33'],()=>{
    console.log('Server is running...')
})

// Router
const router = require('./controller/router')
app.use('/user', router)

```
<br>

` router.js`
```
const express = require('express')
const mongoose = require('mongoose')


const User = mongoose.model('User')

const router = express.Router()

router.get('/',(req,res)=>{
    res.redirect('/user/contacts') // router redirectÎäî ÏïûÏóê '/user/'Í∞Ä Î∂ôÎäîÎã§
})

router.get('/contacts',(req,res)=>{
    User.find({},(err,docs)=>{ //  Î™®Îì† Îç∞Ïù¥ÌÑ∞ Î∞õÏùå, {}Îäî ÏÉùÎûµÍ∞ÄÎä•
        if(!err){
            res.render('contacts/index',{list:docs})
        }
    }).lean()
})

router.get('/contacts/new',(req,res)=>{
    res.render('contacts/new')
})

router.post('/contacts/new',(req,res)=>{
    User.create(req.body,(err,contact)=>{
        if(!err){res.redirect('/user')}
        else{
            return res.json(err)
        }
    })
    }
)

// Show
router.get('/contacts/:id',(req,res)=>{
    User.findOne({_id:req.params.id}, (err, doc)=>{ // findById(req.params.id Ï∞∏Í≥†
        if(!err){
            res.render('contacts/show',{contact: doc})
        }else{
            return res.json(err)
        }
    }).lean()
})

// Edit
router.get('/contacts/:id/edit', (req, res)=>{
    User.findById(req.params.id, (err, doc)=>{
        if(!err){
            res.render('contacts/edit',{contact:doc})
        }
    }).lean()
})
router.put('/contacts/:id', (req,res)=>{
    User.findOneAndUpdate({_id:req.params.id},req.body,(err, doc)=>{
        if(!err){
            res.redirect('/user')
        }
    })
})

// Delete
router.delete('/contacts/:id',(req,res)=>{
    User.deleteOne({_id:req.params.id},(err)=>{ // findByIdAndRemove(req.params.id Ï∞∏Í≥†
        if(err) return res.json(err)
        res.redirect('/user/contacts')
    })
})

module.exports = router
```
<br>

`layout.hbs`
```
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="http://localhost:3000/style.css"> 
    {{!-- router ÏÇ¨Ïö© Ïãú Ï†àÎåÄÍ≤ΩÎ°ú ÏÇ¨Ïö©Ìï¥Ïïº Ïò§Î•òÍ∞Ä ÏóÜÎã§ Î∂ÄÎ™® Í≤ΩÎ°úÍ∞Ä Î£®Ìä∏, '/user' ÌòÑÏû¨ Í≤ΩÎ°ú, --}}
</head>
<body>
    <nav>
        <div><h3>Contact Book</h3></div>
        <div><a href="/user/contacts">Index</a></div>
        <div><a href="/user/contacts/new">New</a></div>
    </nav>
    {{{body}}}
</body>
</html>
```
<br>

` new.hbs`
```
<h2>New</h2>
<form action="/user/contacts/new" method="post">
    <div>
    <label for="name">Name</label>
    <input type="text" id="name" name="name">
    </div>
    <div>
    <label for="email">Email</label>
    <input type="text" id="email" name="email">
    </div>
    <div>
    <label for="phone">Phone</label>
    <input type="text" id="phone" name="phone">
    </div>

    <input type="submit" value="Îì±Î°ù">
</form>
```
<br>

` show.hbs`
```
<h2>Show</h2>
<ul>
    <li>
        Ïù¥Î¶ÑÏùÄ : {{contact.name}}
    </li>
    <li>
        Î©îÏùºÏùÄ : {{contact.email}}
    </li>
    <li>
        Ï†ÑÌôî : {{contact.phone}}
    </li>
</ul>
<a href="/user/contacts/{{contact._id}}/edit">Edit</a>
<form action="/user/contacts/{{contact._id}}?_method=delete" method="post">
    <input type="submit" onclick="return confirm('Ï†ïÎßê?')" value="Delete">
</form>
```
<br>

`edit.hbs`
```
<h2>Edit</h2>
<form action="/user/contacts/{{contact._id}}?_method=put" method="post">
    <div>
        <label for="name">Name</label>
        <input type="text" id="name" name="name" value="{{contact.name}}">
    </div>
    <div>
        <label for="email">Email</label>
        <input type="text" id="email" name="email" value="{{contact.email}}">
    </div>
    <div>
        <label for="phone">Phone</label>
        <input type="text" id="phone" name="phone" value="{{contact.phone}}">
    </div>
    <div>
        <input type="submit" value="Ïø®Ïø®">
    </div>
</form>
```
<br>

` style.css`
```
*{
    margin: 0;
    padding: 0;
    text-decoration: none;
    list-style: none;
}

nav{
    color: lightgray;
    display: flex;
    flex-direction: row;
    width: 100%;
    height: 50px;
    align-items: center;
    background: ghostwhite;
}

nav div a{
    padding: 10px;
    color: gray;
    font-size: 12px;
    font-weight: bolder;
}
section{
    margin: 0 auto;
    width: 70%;
}
h2{
    color: tomato;
    margin-bottom: 20px;
}

ul{
    width: 100%;
    border: 1px solid lightgray;
    padding: 15px 10px;
}

label{
    display: inline-block;
    width: 80px;
    text-align: right;
}
input[type=submit]{
    border-style: none;
    width: 100px;
    margin-left: 100px;
}
```


